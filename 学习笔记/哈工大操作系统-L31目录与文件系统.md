# 哈工大操作系统-L31目录与文件系统

[TOC]



## 1.文件视图的四层抽象

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810150139726.png" alt="image-20210810150139726" style="zoom:50%;" />

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810150545249.png" alt="image-20210810150545249" style="zoom:50%;" />

- 第一层--生磁盘访问：知道CHS让系统读写磁盘，需要知道柱面号、磁头号、扇区号
- 第二层--盘块号访问：把所有的扇区进行一个编码，编码成盘块号码。上层知道盘块，系统可以自动实现盘块号到物理扇区的映射，然后访问磁盘。
  - 把扇区组织起来成为盘块
- 第三层--字符流访问：用户使用文件，是以字符流来访问的。那么建立字符流到盘块号的映射，用户就能直接指定字符流中的位置，而下层负责实现字符流位置到盘块号到物理位置的翻译。
  - 即如何将同一个文件的所有盘块组织起来。
- 第四层--文件系统：系统组织起来所有的文件。将整个磁盘组织成一个目录树，就形成了用户眼中的文件系统。文件系统的抽象完成后，磁盘是可以在多个系统上使用的。
  - 即如何将所有的文件组织起来

## 2.如何组织起来所有的文件--目录

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810150941762.png" alt="image-20210810150941762" style="zoom:50%;" />

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810151000270.png" alt="image-20210810151000270" style="zoom:50%;" />

- 目录树将多个文件组织起来
- 如何将目录和盘块对应起来，就是实现目录的核心

## 3.实现目录

### 3.1用户如何使用目录

- 我们可以由目录树定义的位置，准确的找到文件
- 而由文件，可以找到文件的FCB
- 通过FCB我们可以找到文件所对应的一堆盘块
- 把盘块加入电梯队列，等待访问
- 中断发生，系统根据要访问的特定盘块，翻译成CHS，然后根据CHS访问生磁盘

### 3.2目录下存放什么？

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810152107510.png" alt="image-20210810152107510" style="zoom:75%;" />

- 存放文件名和FCB的号码，而不是把所有的FCB都存了。
- **目录项=文件名+对应FCB的地址**

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810152322103.png" alt="image-20210810152322103" style="zoom:50%;" />

访问逻辑：

- 在某个目录下，根据文件名/目录名对改目录下的目录项一一匹配。
- 找到匹配的目录项后，根据目录项目中的FCB号码，在FCB数组中读取FCB的信息，找到这个目录/文件的数据块。
- 跳转到这个文件/目录的数据块里面
- 如果继续是目录，那么数据块里面存放的还是目录项
- 然后继续匹配目录，找FCB，跳到数据块
- 周而复始
- 对根目录：根目录的FCB会放在**固定的位置**。根据根目录FCB找到数据块，数据块中存放的就是根目录下面的目录项。然后根据根目录下面的目录项去匹配，然后找到下一层目录的FCB。然后由下一层目录的FCB找到下一层目录的数据块。

### 3.3磁盘为了适应目录树的组织

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810153134314.png" alt="image-20210810153134314" style="zoom:75%;" />

## 4.总结：磁盘如何使用

- 目录解析找到文件
- 根据找到的文件的FCB，以及用户要访问的字符流的位置，找到对应的盘块
- 要加入电梯队列去读写盘块了
- 磁盘中断取出盘块号，算出物理位置
- 然后读写物理位置
