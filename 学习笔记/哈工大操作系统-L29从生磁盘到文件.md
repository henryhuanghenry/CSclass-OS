# 哈工大操作系统-L29从生磁盘到文件

[TOC]



- **用户是从文件的角度使用磁盘的。**因此，如何建立文件和盘块号的连接，就是本课核心。
- 用户使用文件实际为字符流。
- 如何找到字符流对应的真正物理位置，是操作系统的任务。
- 建立文件到盘块的映射，需要设计文件结构。



## 1.用户眼中的文件

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810130502901.png" alt="image-20210810130502901" style="zoom:50%;" />

- 用户眼中的文件，是一个字符序列，为字符流。
- 因此，**文件**就是建立**字符流到盘块集合的映射**。
- 用户在字符流上面的折腾，要落实到盘块上面。比如用户要删除某几行，那么系统就需要去找到相应的盘块号，然后去修改那些盘块中的数据。

## 2.文件结构1--连接结构

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810131113583.png" alt="image-20210810131113583" style="zoom:50%;" />

- 一个文件也需要数据结构来表示。叫FCB，FCB保存一些数据，能够在系统中找到我们的文件。
- 连续结构就很简单能算出盘块到底在哪。
- 操作系统得到盘块号后，负责读写字符。
- 优点：读写方便
- 缺点：不适合动态增长，比如如果空闲的块只有5个，如果变成6个的话，就需要搬到其他的地方了

## 3.文件结构2--链式结构

- 读写文件时，通过FCB找到文件的第一个盘块号，然后通过物理块中构建的链式结构，逐个读取下一个盘块，直到找到需要的盘块为止
- 优点：增长方便
- 缺点：读写慢

## 4.文件结构3--索引结构

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810143406624.png" alt="image-20210810143406624" style="zoom:50%;" />

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810143453046.png" alt="image-20210810143453046" style="zoom:50%;" />

- 文件的盘块的映射信息放在索引块中，通过索引块找到真正的盘块
- 对小文件，可以直接索引
- 对于大文件，间接的索引

## 5.小题目

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210810143712558.png" alt="image-20210810143712558" style="zoom:50%;" />

- 因为词典后期改动小，但是需要的访问速度要快，因此是A
