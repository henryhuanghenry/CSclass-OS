# 哈工大操作系统-L21内存分区与分页

[TOC]



- 我们要在内存中找一段空闲的区域，分配给程序。那么，我们如何找到这个空闲的分区? 因此，本次的核心就是，如何找到/分配空闲的分区
- **实际系统的物理内存一般是通过分页，非常少使用分区。 分区一般对虚拟内存进行管理。**
- **用户需要分段**，因为程序是按段组织的。**物理内存需要分页**，因为分页浪费少。因此，系统应该分页和分段都支持



## 1.固定分区与可变分区的抉择

固定分区容易造成浪费，因此一般使用可变分区

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210808113401908.png" alt="image-20210808113401908" style="zoom:50%;" />



## 2.可变分区的管理

- 要维护内存数据结构
- 要设计分配的算法

### 2.1数据结构：空闲分区表+已分配分区表

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210808113628555.png" alt="image-20210808113628555" style="zoom:50%;" />

### 2.2管理过程--请求分配

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210808113649226.png" alt="image-20210808113649226" style="zoom:50%;" />

### 2.3管理过程--释放内存

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210808113715514.png" alt="image-20210808113715514" style="zoom:50%;" />

### 2.4管理过程--再次申请(多种解法，涉及到算法)

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210808113853354.png" alt="image-20210808113853354" style="zoom:50%;" />

- **最佳适配**--长度与申请长度适配好；但由于适配好，剩余内存不多，内存会越割越小o(n)
- **最差适配**--内存会割的比较均匀o(n)
- **首先适配**--查表快o(1)

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210808114253528.png" alt="image-20210808114253528" style="zoom:50%;" />



## 3.分页

### 3.1可变分区容易造成碎片

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210808114517251.png" alt="image-20210808114517251" style="zoom:50%;" />

内存紧缩的时候，单核CPU是执行不了上层用户的进程的。

### 3.2将内存分成页

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210808115034784.png" alt="image-20210808115034784" style="zoom:50%;" />

- 把内存分成页，**页是内存的分配单位**
- 搬移时，把**程序段拆分成页**，一部分一部分的往页里面塞
- 每个程序段最多浪费的也就一。假设页的大小是4K，那么塞不满的页也就最多浪费4k。因此，浪费少，不需要内存紧缩。

### 3.3程序塞入内存的例子

<img src="E:\AAAAAAAuniPPT\4_1PPT\CSclass-OS(git)\学习笔记\${图片}\image-20210808115513506.png" alt="image-20210808115513506" style="zoom:50%;" />

- **页框**：内存中容纳一页的地方。指的就是内存空间，而这个内存空间可以容纳一页
- **页号**：一个索引号，段被分成多页之后，每个页叫索引。搬移时，每页都放到内存中空闲的页框
- 页框页号映射：逻辑地址由两部分组成了，页号+偏移。使用页号可以找到内存中存放该页对应的页框号，再使用偏移我们就可以找到物理地址了。
- 这个例子中，页尺寸是4k，因此偏移的地址可以占3个16进制位。